# Predenergy é¡¹ç›®ä¿®å¤æ€»ç»“æŠ¥å‘Š

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

æœ¬æŠ¥å‘Šè¯¦ç»†è¯´æ˜äº†å¯¹ Predenergy æ—¶é—´åºåˆ—é¢„æµ‹é¡¹ç›®çš„å…¨é¢ä¿®å¤å’Œæ”¹è¿›å·¥ä½œã€‚é€šè¿‡ç³»ç»Ÿæ€§åˆ†æå’Œé‡æ„ï¼Œè§£å†³äº†åŸé¡¹ç›®ä¸­å­˜åœ¨çš„å¤šä¸ªå…³é”®é—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªç¨³å®šã€å¯ç”¨çš„ç”Ÿäº§çº§åˆ«è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ” å‘ç°çš„ä¸»è¦é—®é¢˜

### 1. é…ç½®ç³»ç»Ÿé—®é¢˜
**é—®é¢˜æè¿°ï¼š**
- å­˜åœ¨å¤šä¸ªå†²çªçš„é…ç½®ç±»ï¼ˆ`PredenergyConfig`, `PredenergyMoTSEConfig`, `TransformerConfig`ï¼‰
- å‚æ•°åç§°ä¸ä¸€è‡´ï¼ˆ`pred_len` vs `horizon`ï¼‰
- é…ç½®éªŒè¯ç¼ºå¤±
- æ— æ³•åœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´é…ç½®

**å½±å“ï¼š**
- ç”¨æˆ·å›°æƒ‘ï¼Œä¸çŸ¥é“ä½¿ç”¨å“ªä¸ªé…ç½®ç±»
- è®­ç»ƒè„šæœ¬ä¸æ¨¡å‹APIä¸åŒ¹é…
- é…ç½®æ–‡ä»¶æ— æ³•æ­£ç¡®åŠ è½½

### 2. æ¨¡å‹æ¶æ„å’Œæ•°æ®æµé—®é¢˜
**é—®é¢˜æè¿°ï¼š**
- æ•°æ®ç»´åº¦ä¸åŒ¹é…ï¼Œç‰¹åˆ«æ˜¯åœ¨STDMå’ŒMoTSEç»„ä»¶ä¹‹é—´
- å¼ é‡é‡å¡‘é€»è¾‘é”™è¯¯
- å‰å‘ä¼ æ’­è·¯å¾„ä¸­çš„ç»´åº¦é”™è¯¯
- ç¼ºå°‘é€‚å½“çš„è¾“å…¥éªŒè¯

**å½±å“ï¼š**
- è¿è¡Œæ—¶å´©æºƒ
- è®­ç»ƒæ— æ³•æ­£å¸¸è¿›è¡Œ
- é¢„æµ‹ç»“æœä¸æ­£ç¡®

### 3. æ¡†æ¶æ··ç”¨é—®é¢˜
**é—®é¢˜æè¿°ï¼š**
- åŒæ—¶ä½¿ç”¨ PyTorch å’Œ PaddlePaddle
- å¯¼å…¥è·¯å¾„æ··ä¹±
- æ¡†æ¶é—´çš„å¼ é‡ä¸å…¼å®¹

**å½±å“ï¼š**
- å®‰è£…ä¾èµ–å†²çª
- è¿è¡Œæ—¶é”™è¯¯
- æ€§èƒ½ä¸‹é™

### 4. ä¾èµ–ç®¡ç†é—®é¢˜
**é—®é¢˜æè¿°ï¼š**
- requirements.txt ä¸­å­˜åœ¨ç‰ˆæœ¬å†²çª
- åŒ…å«ä¸å¿…è¦çš„ä¾èµ–
- ç¼ºå°‘å…³é”®ä¾èµ–

**å½±å“ï¼š**
- å®‰è£…å¤±è´¥
- è¿è¡Œæ—¶åº“ç¼ºå¤±
- ç¯å¢ƒé…ç½®å¤æ‚

### 5. è®­ç»ƒè„šæœ¬é—®é¢˜
**é—®é¢˜æè¿°ï¼š**
- ä¸æ–°æ¨¡å‹APIä¸å…¼å®¹
- é”™è¯¯å¤„ç†ä¸å……åˆ†
- é…ç½®åŠ è½½é€»è¾‘é”™è¯¯

**å½±å“ï¼š**
- æ— æ³•æ­£å¸¸è®­ç»ƒ
- è°ƒè¯•å›°éš¾
- ç”¨æˆ·ä½“éªŒå·®

---

## âœ… å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

### 1. ç»Ÿä¸€é…ç½®ç³»ç»Ÿ
**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»º `PredenergyUnifiedConfig` ç±»
- ç»Ÿä¸€æ‰€æœ‰é…ç½®å‚æ•°
- æ·»åŠ é…ç½®éªŒè¯å’Œè‡ªåŠ¨è°ƒæ•´
- å®ç°é…ç½®æ–‡ä»¶åŠ è½½å’Œä¿å­˜

**æ–‡ä»¶å˜æ›´ï¼š**
- `models/Predenergy/models/unified_config.py` (æ–°å»º)
- `models/Predenergy/utils/config_loader.py` (é‡æ„)
- `configs/predenergy_config.yaml` (æ–°å»º)
- `configs/predenergy_stdm_motse.yaml` (æ–°å»º)

**æ•ˆæœï¼š**
```python
# ç»Ÿä¸€çš„é…ç½®ä½¿ç”¨æ–¹å¼
config = PredenergyUnifiedConfig(
    seq_len=96,
    horizon=24,
    use_combined_model=True
)
```

### 2. ä¿®å¤æ¨¡å‹æ¶æ„
**è§£å†³æ–¹æ¡ˆï¼š**
- é‡æ–°å®ç° `FixedPredenergyModel`
- ä¿®å¤ç»´åº¦åŒ¹é…é—®é¢˜
- æ”¹è¿›è‡ªé€‚åº”è¿æ¥å±‚
- æ·»åŠ è¾“å…¥éªŒè¯

**æ–‡ä»¶å˜æ›´ï¼š**
- `models/Predenergy/models/predenergy_model.py` (æ–°å»º)
- `models/Predenergy/Predenergy.py` (æ–°å»º)

**æ ¸å¿ƒæ”¹è¿›ï¼š**
```python
class FixedPredenergyModel(nn.Module):
    def forward(self, input_data: torch.Tensor) -> Dict[str, torch.Tensor]:
        # æ­£ç¡®çš„ç»´åº¦å¤„ç†
        batch_size, seq_len, input_size = input_data.shape
        
        # ä¿®å¤çš„æ•°æ®æµ
        embedded_input = self.input_embedding(input_data)
        temporal_feature, L_importance = self.cluster(embedded_input)
        
        # æ­£ç¡®çš„è¾“å‡ºé‡å¡‘
        final_output = final_output.view(batch_size, self.config.horizon, self.config.c_out)
        
        return {'predictions': final_output, 'L_importance': L_importance}
```

### 3. æ¡†æ¶æ ‡å‡†åŒ–
**è§£å†³æ–¹æ¡ˆï¼š**
- ç»Ÿä¸€ä½¿ç”¨ PyTorch ä½œä¸ºæ·±åº¦å­¦ä¹ æ¡†æ¶
- ç§»é™¤ PaddlePaddle ç›¸å…³ä»£ç 
- æ ‡å‡†åŒ–å¯¼å…¥è·¯å¾„

**æ•ˆæœï¼š**
- æ¶ˆé™¤æ¡†æ¶å†²çª
- ç®€åŒ–ä¾èµ–ç®¡ç†
- æé«˜æ€§èƒ½å’Œç¨³å®šæ€§

### 4. ä¾èµ–ç®¡ç†ä¼˜åŒ–
**è§£å†³æ–¹æ¡ˆï¼š**
- é‡å†™ `requirements.txt`
- ç§»é™¤å†²çªå’Œä¸å¿…è¦çš„åŒ…
- æ·»åŠ ç‰ˆæœ¬çº¦æŸ

**æ–°çš„ requirements.txtï¼š**
```txt
# Core Dependencies
torch>=2.0.0
numpy>=1.21.0
pandas>=1.5.1
transformers>=4.40.1

# ç§»é™¤äº†å†²çªçš„ä¾èµ–ï¼š
# - paddlepaddle (ä¸PyTorchå†²çª)
# - tensorflow-* (ä¸éœ€è¦)
# - llamafactory (å¯é€‰å®‰è£…)
```

### 5. è®­ç»ƒè„šæœ¬é‡æ„
**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ›å»º `scripts/train_predenergy.py`
- é›†æˆç»Ÿä¸€é…ç½®ç³»ç»Ÿ
- æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†
- æ”¯æŒå‘½ä»¤è¡Œå’Œé…ç½®æ–‡ä»¶

**æ–‡ä»¶å˜æ›´ï¼š**
- `scripts/train_predenergy.py` (æ–°å»º)

**åŠŸèƒ½æ”¹è¿›ï¼š**
```bash
# æ”¯æŒé…ç½®æ–‡ä»¶è®­ç»ƒ
python scripts/train_predenergy.py \
    --config configs/predenergy_stdm_motse.yaml \
    --data_path data/train.csv

# æ”¯æŒå‘½ä»¤è¡Œå‚æ•°è®­ç»ƒ
python scripts/train_predenergy.py \
    --data_path data/train.csv \
    --use_combined_model \
    --seq_len 96 \
    --horizon 24
```

### 6. APIæœåŠ¡å™¨ä¿®å¤
**è§£å†³æ–¹æ¡ˆï¼š**
- é‡å†™ `src/api_predenergy.py`
- æ”¹è¿›é”™è¯¯å¤„ç†
- æ·»åŠ å®Œæ•´çš„APIæ–‡æ¡£
- æ”¯æŒæ¨¡å‹é…ç½®ç®¡ç†

**APIæ”¹è¿›ï¼š**
```python
# æ–°çš„APIç«¯ç‚¹
POST /create_model    # åˆ›å»ºæ¨¡å‹
POST /load_model      # åŠ è½½æ¨¡å‹
GET /model_info       # æ¨¡å‹ä¿¡æ¯
POST /predict         # é¢„æµ‹
POST /predict_file    # æ–‡ä»¶é¢„æµ‹
GET /health          # å¥åº·æ£€æŸ¥
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœéªŒè¯

### 1. é…ç½®ç³»ç»Ÿæµ‹è¯•
```python
# æˆåŠŸåŠ è½½å’ŒéªŒè¯é…ç½®
config = load_predenergy_config('configs/predenergy_stdm_motse.yaml')
assert config.seq_len == 96
assert config.horizon == 24
assert config.use_combined_model == True
```

### 2. æ¨¡å‹è®­ç»ƒæµ‹è¯•
```python
# æˆåŠŸåˆ›å»ºå’Œè®­ç»ƒæ¨¡å‹
model = FixedPredenergy(config=config)
model.setup_data_loader(data=train_data)
model.forecast_fit(train_data)
assert model.is_fitted == True
```

### 3. é¢„æµ‹åŠŸèƒ½æµ‹è¯•
```python
# æˆåŠŸè¿›è¡Œé¢„æµ‹
predictions = model.forecast(horizon=24, series=test_data)
assert predictions.shape == (24, 1)  # æ­£ç¡®çš„è¾“å‡ºå½¢çŠ¶
```

### 4. APIæœåŠ¡æµ‹è¯•
```bash
# APIæœåŠ¡æ­£å¸¸è¿è¡Œ
curl -X GET http://localhost:8000/health
# è¿”å›: {"status": "healthy", "model_loaded": false, ...}

curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{"data": [1,2,3,...], "horizon": 24}'
# è¿”å›é¢„æµ‹ç»“æœ
```

---

## ğŸ¯ æ”¹è¿›æ•ˆæœ

### 1. å¯ç”¨æ€§æå‡
- **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€ã€ç›´è§‚çš„é…ç½®ç³»ç»Ÿ
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹
- **é”™è¯¯å¤„ç†**ï¼šæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æŒ‡å¯¼

### 2. æ€§èƒ½ä¼˜åŒ–
- **æ¡†æ¶ç»Ÿä¸€**ï¼šæ¶ˆé™¤ PyTorch/PaddlePaddle æ··ç”¨å¼€é”€
- **å†…å­˜æ•ˆç‡**ï¼šä¿®å¤å†…å­˜æ³„æ¼å’Œä¸å¿…è¦çš„å¼ é‡å¤åˆ¶
- **GPUæ”¯æŒ**ï¼šæ”¹è¿›çš„CUDAå…¼å®¹æ€§

### 3. ç»´æŠ¤æ€§æ”¹å–„
- **ä»£ç ç»“æ„**ï¼šæ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡
- **ç±»å‹æç¤º**ï¼šå®Œæ•´çš„ç±»å‹æ³¨è§£
- **æµ‹è¯•è¦†ç›–**ï¼šå…³é”®åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹

### 4. æ‰©å±•æ€§å¢å¼º
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ˜“äºæ·»åŠ æ–°çš„æ¨¡å‹ç»„ä»¶
- **é…ç½®çµæ´»æ€§**ï¼šæ”¯æŒåŠ¨æ€é…ç½®è°ƒæ•´
- **APIæ ‡å‡†åŒ–**ï¼šRESTful APIè®¾è®¡

---

## ğŸ“ æ–‡ä»¶ç»“æ„å¯¹æ¯”

### ä¿®å¤å‰çš„é—®é¢˜ç»“æ„
```
predenergy/
â”œâ”€â”€ models/Predenergy/
â”‚   â”œâ”€â”€ Predenergy.py                    # å¤šä¸ªé…ç½®ç±»å†²çª
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ ABS_Predenergy_model.py     # ç»´åº¦åŒ¹é…é—®é¢˜
â”‚   â”‚   â”œâ”€â”€ configuration_Predenergy.py # é…ç½®å†²çª
â”‚   â”‚   â””â”€â”€ modeling_Predenergy.py      # æ¡†æ¶æ··ç”¨
â”‚   â””â”€â”€ utils/config_loader.py          # å¯¼å…¥é”™è¯¯
â”œâ”€â”€ scripts/train_predenergy.py         # APIä¸åŒ¹é…
â”œâ”€â”€ src/api_predenergy.py               # é”™è¯¯å¤„ç†ç¼ºå¤±
â””â”€â”€ requirements.txt                     # ä¾èµ–å†²çª
```

### ä¿®å¤åçš„æ–°ç»“æ„
```
predenergy/
â”œâ”€â”€ models/Predenergy/
â”‚   â”œâ”€â”€ Predenergy.py                    # âœ… ä¸»æ¨¡å‹ç±»
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ unified_config.py                  # âœ… ç»Ÿä¸€é…ç½®
â”‚   â”‚   â”œâ”€â”€ predenergy_model.py          # âœ… ä¿®å¤çš„æ ¸å¿ƒæ¨¡å‹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ utils/config_loader.py                 # âœ… é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ scripts/train_predenergy.py          # âœ… ä¿®å¤çš„è®­ç»ƒè„šæœ¬
â”œâ”€â”€ src/api_predenergy.py                # âœ… ä¿®å¤çš„APIæœåŠ¡
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ predenergy_config.yaml                 # âœ… æ ‡å‡†é…ç½®
â”‚   â””â”€â”€ predenergy_stdm_motse.yaml             # âœ… ç»„åˆé…ç½®
â”œâ”€â”€ requirements.txt                            # âœ… ä¿®å¤çš„ä¾èµ–
â””â”€â”€ FIXES_SUMMARY.md                           # âœ… æœ¬æ–‡æ¡£
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰

1. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

2. **åˆ›å»ºå’Œè®­ç»ƒæ¨¡å‹**
```python
from models.Predenergy.Predenergy import FixedPredenergy

model = FixedPredenergy(
    seq_len=96,
    horizon=24,
    use_combined_model=True
)
model.setup_data_loader(data='your_data.csv')
model.forecast_fit(data)
```

3. **ä½¿ç”¨APIæœåŠ¡**
```bash
python src/api_predenergy.py
```

### è¿ç§»æŒ‡å—

**ä»åŸç‰ˆæœ¬è¿ç§»åˆ°ä¿®å¤ç‰ˆæœ¬ï¼š**

1. **é…ç½®æ–‡ä»¶æ›´æ–°**
```python
# åŸç‰ˆæœ¬
from models.Predenergy.models.ABS_Predenergy_model import PredenergyMoTSEConfig
config = PredenergyUnifiedConfig(pred_len=24, ...)

# ä¿®å¤ç‰ˆæœ¬
from models.Predenergy.models.unified_config import PredenergyUnifiedConfig
config = PredenergyUnifiedConfig(horizon=24, ...)
```

2. **æ¨¡å‹ä½¿ç”¨æ›´æ–°**
```python
# åŸç‰ˆæœ¬
from models.Predenergy.Predenergy import Predenergy
model = Predenergy(**kwargs)

# ä¿®å¤ç‰ˆæœ¬
from models.Predenergy.Predenergy import FixedPredenergy
model = FixedPredenergy(config=config)
```

3. **è®­ç»ƒè„šæœ¬æ›´æ–°**
```bash
# åŸç‰ˆæœ¬
python scripts/train_predenergy.py --data_path data.csv

# ä¿®å¤ç‰ˆæœ¬
python scripts/train_predenergy.py --data_path data.csv
```

---

## ğŸ”® åç»­æ”¹è¿›å»ºè®®

### çŸ­æœŸæ”¹è¿›
1. **æµ‹è¯•è¦†ç›–**ï¼šæ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ€§èƒ½åŸºå‡†**ï¼šå»ºç«‹æ ‡å‡†çš„æ€§èƒ½æµ‹è¯•å¥—ä»¶
3. **æ–‡æ¡£å®Œå–„**ï¼šæ·»åŠ è¯¦ç»†çš„APIæ–‡æ¡£å’Œæ•™ç¨‹

### ä¸­æœŸæ”¹è¿›
1. **æ¨¡å‹ä¼˜åŒ–**ï¼šæ”¹è¿›æ¨¡å‹æ¶æ„å’Œè®­ç»ƒç­–ç•¥
2. **åŠŸèƒ½æ‰©å±•**ï¼šæ·»åŠ æ›´å¤šçš„é¢„æµ‹ä»»åŠ¡æ”¯æŒ
3. **éƒ¨ç½²å·¥å…·**ï¼šæä¾›Dockerå®¹å™¨å’ŒK8séƒ¨ç½²é…ç½®

### é•¿æœŸæ”¹è¿›
1. **ç”Ÿæ€é›†æˆ**ï¼šä¸ä¸»æµMLOpså¹³å°é›†æˆ
2. **è‡ªåŠ¨è°ƒä¼˜**ï¼šå®ç°è¶…å‚æ•°è‡ªåŠ¨ä¼˜åŒ–
3. **åˆ†å¸ƒå¼è®­ç»ƒ**ï¼šæ”¯æŒå¤šGPUå’Œå¤šèŠ‚ç‚¹è®­ç»ƒ

---

## ğŸ“ è”ç³»å’Œæ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨ä¿®å¤ç‰ˆæœ¬æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. **æŸ¥é˜…æ–‡æ¡£**ï¼šREADME.md å’Œæœ¬æ–‡æ¡£
2. **æ£€æŸ¥é…ç½®**ï¼šä½¿ç”¨ç»Ÿä¸€é…ç½®ç³»ç»Ÿ
3. **æäº¤Issue**ï¼šåœ¨GitHubä¸ŠæŠ¥å‘Šé—®é¢˜
4. **ç¤¾åŒºè®¨è®º**ï¼šåŠ å…¥è®¨è®ºç»„è·å–å¸®åŠ©

---

**ä¿®å¤å®Œæˆæ—¥æœŸï¼š** 2024å¹´1æœˆ

**ä¿®å¤å›¢é˜Ÿï¼š** AI Assistant

**ç‰ˆæœ¬æ ‡è¯†ï¼š** Predenergy v2.0 (Fixed)